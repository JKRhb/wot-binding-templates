<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class='remove'></script>
    <script class='remove'>
        var respecConfig = {
            specStatus: "ED",
            editors: [],
            edDraftURI: "",
            shortName: "wot-modbus-template",
            otherLinks: [
                {
                    key: "Other documentation",
                    data: [{
                        value: "MODBUS ontology",
                        href: "https://github.com/w3c/wot-binding-templates/graphs/contributors"
                    }]
                }
            ]
        };
    </script>
    <title>MODBUS binding template</title>
</head>

<body>
    <section id='abstract'>
        <p class="ednote">TODO:</p>
    </section>
    <section id='sotd'>
        <p>
            <em>This document is a work in progress</em>
        </p>
    </section>
    <section>
        <h2>Modbus Vocabulary</h2>
        <section>
            <h3>Form terms</h3>
            <table class="def">
                <thead>
                    <tr>
                        <th>Vocabulary term</th>
                        <th>Description</th>
                        <th>Assignment</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Generate forms terms from the ontology-->
                    
        <tr>
            <td><code>modv:entity</code></td>
            <td>A registry type to let the runtime automatically detect the right function code</td>
            <td></td>
            <td><a href="#entity">Entity</a></td>
        <tr>
        

        <tr>
            <td><code>modv:firstDWordLow</code></td>
            <td>Data encoding for 64-bit values; same as firstWordLow but based on DWORDS (i.e. 2 registers) instead of WORDS (1 register)</td>
            <td></td>
            <td><a href="http://www.w3.org/2001/XMLSchema#boolean">boolean</a></td>
        <tr>
        

        <tr>
            <td><code>modv:firstWordLow</code></td>
            <td>Data encoding for 32-bit values to chose which of the register is the low value</td>
            <td></td>
            <td><a href="http://www.w3.org/2001/XMLSchema#boolean">boolean</a></td>
        <tr>
        

        <tr>
            <td><code>modv:function</code></td>
            <td>Function Code sent by the master in every request. Specifying the desired interaction.</td>
            <td></td>
            <td><a href="#functioncode">FunctionCode</a></td>
        <tr>
        

        <tr>
            <td><code>modv:function</code></td>
            <td>Function Code sent by the master in every request. Specifying the desired interaction.</td>
            <td></td>
            <td><a href="#functionname">FunctionName</a></td>
        <tr>
        

        <tr>
            <td><code>modv:length</code></td>
            <td>Specifies the amount of either registers or coils to be read/written</td>
            <td></td>
            <td><a href="http://www.w3.org/2001/XMLSchema#integer">integer</a></td>
        <tr>
        

        <tr>
            <td><code>modv:offset</code></td>
            <td>Specifies the starting address of the modbus operations</td>
            <td></td>
            <td><a href="http://www.w3.org/2001/XMLSchema#integer">integer</a></td>
        <tr>
        

        <tr>
            <td><code>modv:pollingTime</code></td>
            <td>The Modbus specification does not define a maximum or minimum allowed polling rate, however specific implementations might introduce such limits. Defined as integer of milliseconds.</td>
            <td></td>
            <td><a href="http://www.w3.org/2001/XMLSchema#integer">integer</a></td>
        <tr>
        

        <tr>
            <td><code>modv:timeout</code></td>
            <td>Defines how much time the runtime should wait until it receives a reply from the device.</td>
            <td></td>
            <td><a href="http://www.w3.org/2001/XMLSchema#integer">integer</a></td>
        <tr>
        

        <tr>
            <td><code>modv:unitID</code></td>
            <td>The Unit ID is usually not needed for ModbusTCP, since the IP-address works as unique identifier, but for compability reasons still often included</td>
            <td></td>
            <td><a href="http://www.w3.org/2001/XMLSchema#integer">integer</a></td>
        <tr>
        

        <tr>
            <td><code>modv:zeroBasedAddressing</code></td>
            <td>Modbus implementations can differ in the way addressing works, as the first coil/register can be either referred to as '0' or '1'. Default is '0'.</td>
            <td></td>
            <td><a href="http://www.w3.org/2001/XMLSchema#boolean">boolean</a></td>
        <tr>
        
                </tbody>
            </table>
        </section>
        <section>
            <h3>Default mappings</h3>
            <table class="def">
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th>Default Biding</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Generate mappings from the mapping ontology -->
                    
        <tr>
            <td><code>readallproperties</code></td>
            <td><code>"modv:function":3</code></td>
        <tr>
        

        <tr>
            <td><code>readmultipleproperties</code></td>
            <td><code>"modv:function":3</code></td>
        <tr>
        

        <tr>
            <td><code>writeallproperties</code></td>
            <td><code>"modv:function":16</code></td>
        <tr>
        

        <tr>
            <td><code>writemultipleproperties</code></td>
            <td><code>"modv:function":16</code></td>
        <tr>
        

        <tr>
            <td><code>readproperty</code></td>
            <td><code>"modv:function":1</code></td>
        <tr>
        

        <tr>
            <td><code>invokeaction</code></td>
            <td><code>"modv:function":5</code></td>
        <tr>
        

        <tr>
            <td><code>writeproperty</code></td>
            <td><code>"modv:function":5</code></td>
        <tr>
        
                </tbody>
            </table>
        </section>
        <section>
            <h3>Entity</h3>
            <p class="ednote">TODO:provide a developer oriented explanation of modbus:Entity. 
                Possibly list all the admitted values.
            </p>
        </section>
        <section id="functioncode">
            <h3>Function Code</h3>
            <p class="ednote">TODO:provide a developer oriented explanation of modbus:FunctionCode 
                Possibly list all the admitted values.
            </p>
        </section>
        <section id="functionname">
            <h3>Function Name</h3>
            <p class="ednote">TODO:provide a developer oriented explanation of modbus:FunctionName
                Possibly list all the admitted values.
            </p>
        </section>
    </section>
    <section>
        <h2>Examples</h2>
        <pre class="example" title="TD of a Thing with Modbus interface">
                {
                  "@context": [
                      "https://www.w3.org/2019/wot/td/v1",
                      {
                          "modv": "https://www.example.com/ns/modbustcp"
                      }
                  ],
                  "title": "ModbusPLC",
                  "description": "An industrial machine, retrofitted to be IoT capable.",
                  "id": "uri:dev:ModbusTCPThing",
                  "securityDefinitions": {
                      "nosec_sc": {
                          "scheme": "nosec"
                      }
                  },
                  "security": "nosec_sc",
              
                  "base": "",
                  "properties": {
                      "limitSwitch1": {
                          "title": "downLimitSwitch",
                          "type": "boolean",
                          "description": "Limit switch moving downwards",
                          "forms": [
                              {
                                  "op": "readproperty",
                                  "href": "modbus+tcp://192.168.178.32:502/10003",
                                  "modv:function": "2",
                                  "modv:length": 1,
                                  "modv:offset": "10003",
                                  "modv:unitID": "1",
                                  "contentType": "application/octet-stream"
                              }
                          ]
                      },
                      "limitSwitch2": {
                          "title": "forwardLimitSwitch",
                          "type": "boolean",
                          "description": "Limit Switch moving forward",
                          "forms": [
                              {
                                  "op": "readproperty",
                                  "href": "modbus+tcp://192.168.178.32:502/10002",
                                  "modv:function": "readDiscreteInput",
                                  "modv:length": 1,
                                  "modv:offset": "10002",
                                  "modv:unitID": "1",
                                  "contentType": "application/octet-stream"
                              }
                          ]
                      },
                      "moveDown": {
                          "title": "moveDown",
                          "type": "boolean",
                          "description": "Down Motor Status (single coil). PLC output, can be written to control the motor.",
                          "forms": [
                              {
                                  "op": [
                                      "writeproperty",
                                      "observeproperty",
                                      "readproperty"
                                  ],
                                  "href": "modbus+tcp://192.168.178.32:502/00006",
                                  "modv:entity": "Coil",
                                  "modv:length": 1,
                                  "modv:offset": "00006",
                                  "modv:unitID": "1",
                                  "modv:pollingTime": 100,
                                  "contentType": "application/octet-stream"
                              }
                          ]
                      },
                      "moveForward": {
                          "title": "moveForward",
                          "type": "boolean",
                          "description": "Forward Motor Status (single coil). PLC output, can be written to control the motor.",
                          "forms": [
                              {
                                   "op": [
                                      "writeproperty",
                                      "observeproperty",
                                      "readproperty"
                                  ],
                                  "href": "modbus+tcp://192.168.178.32:502/00003",
                                  "modv:entity": "Coil",
                                  "modv:length": 1,,
                                  "modv:offset": "00003",
                                  "modv:unitID": "1",
                                  "modv:pollingRate": 100,
                                  "contentType": "application/octet-stream"
                              }
                          ]
                      }
                  }
              }
              </pre>
    </section>
</body>

</html>