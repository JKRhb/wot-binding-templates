<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class='remove'></script>
    <script class='remove'>
        var respecConfig = {
            specStatus: "ED",
            group: "wg/wot",
            editors: [{
                name: "Klaus Hartke",
                w3cid: "107859",
                company: "Siemens AG",
                companyURL: "https://www.siemens.com/"
            }],
            edDraftURI: "https://w3c.github.io/wot-binding-templates/bindings/protocols/coap/",
            shortName: "wot-coap-binding",
            github: "https://github.com/w3c/wot-binding-templates/tree/main/bindings/protocols/coap",
        };
    </script>
    <title>CoAP Binding Template</title>
</head>

<body>
    <section id='abstract'>
        <p class="ednote">TODO: Provide a short overview of the document and the protocol binding features.</p>
    </section>
    <section id='introduction'>
        <h2>Introduction</h2>
        <p>
            The Constrained Application Protocol (CoAP) [[RFC7252]] is a
            specialized web transfer protocol for use with constrained nodes and
            constrained (e.g., low-power, lossy) networks. The nodes often have
            8-bit microcontrollers with small amounts of ROM and RAM, while
            constrained networks such as IPv6 over Low-Power Wireless Personal
            Area Networks (6LoWPANs) often have high packet error rates and a
            typical throughput of 10s of kbit/s. The protocol is designed for
            machine-to-machine (M2M) applications such as smart energy and
            building automation.
        </p>
        <p>
            This document describes how the Web of Things specification can be
            used to present devices that use CoAP in a Thing Description. In
            particular, the document explain how to create valid Forms for the
            different operations that CoAP can perform.
        </p>
    </section>
    <section id='sotd'>
        <p>
            <em>This document is a work in progress</em>
        </p>
    </section>
    <section id="overview">
        <h2>Protocol Overview</h2>
        <p>
            The interaction model of CoAP is similar to the client/server model
            of HTTP. A CoAP request is equivalent to that of HTTP and is sent by
            a client to request an action (using a Method Code) on a resource
            (identified by a URI) on a server.  The server then sends a response
            with a Response Code; this response may include a resource representation.
        </p>
        <p>
            Both requests and responses may include a list of one or more
            options. For example, the URI in a request is transported in several
            options, and metadata that would be carried in an HTTP header in HTTP
            is supplied as options as well. In general, options are set as part of
            using CoAP features, such as the <code>Observe</code> option being
            set when [[RFC7641|Observing Resources]].
        </p>
        <p>
            The section below gives an overview of the features offered by CoAP at the time of writing
            and provides examples of a how they can be used in a [[[WOT-THING-DESCRIPTION]]].
            The vocabulary terms used in these examples are defined in section [[[#vocabulary]]] below.
        </p>
        <aside class="ednote">
            <p>
                In contrast to HTTP, where header fields all follow the same key-value based structure,
                CoAP defines specific formats for its options, which all have to be registered with IANA,
                being the primary way for adding new features to the protocol.
            </p>
            <p>
                Due to the highly standardized nature of CoAP options, mapping them to a vocabulary
                of <em>features</em> makes more sense than offering a generic format for defining them
                within a TD form, also considering that there are options with binary, numeric or
                string-based values (see sections 3.1 and 3.2 of [[RFC7252]] for more details).
            </p>
        </aside>
        <!-- Maybe RFC numbers could be included in the table? -->
        <section>
            <h3>Requests</h3>
            <p>
                CoAP protocol bindings are added to a form by using a CoAP
                URI scheme (c.f. section [[[#url]]]) in the <code>href</code>
                member. While each <code>op</code> type corresponds to a CoAP
                method code, implying a default value (c.f. section
                [[[#mappings]]]), a <code>coap:method</code> member can also be
                set explicitly to one of the standardized CoAP methods, such as
                <code>GET</code>, <code>PUT</code>, or <code>POST</code>.
            </p>

            <pre id="example-feature-request" class="example" title="Requests">
{
    "op": [ "readproperty" ],
    "href": "coap://[2001:DB8::1]/.../...",
    "coap:method": "GET"
}
</pre>
            <p>
                ... <code>coap:format</code>.
            </p>
            <pre id="example-feature-format" class="example" title="Payload Format">
{
    "op": [ "writeproperty" ],
    "href": "coap://[2001:DB8::1]/.../...",
    "coap:method": "PUT",
    "coap:format": 112  // application/senml+cbor
}
</pre>
        </section>
        <section>
            <h3>Content Negotiation</h3>
            <p>
                ... <code>coap:accept</code>.
            </p>
            <pre id="example-feature-accept" class="example" title="Content Negotiation">
{
    "op": [ "readproperty" ],
    "href": "coap://[2001:DB8::1]/.../...",
    "coap:method": "GET",
    "coap:accept": 112  // application/senml+cbor
}
</pre>
        </section>
        <section>
            <h3>Caching</h3>
            <p>
                ...
            </p>
        </section>
        <section>
            <h3>Observing Resources</h3>
            <p>
                Observing resources as defined in [[RFC7641]] can be enabled by including a
                <code>subprotocol</code> value of <code>coap:observe</code> in a form.
            </p>
            <pre id="example-feature-observe" class="example" title="Observing Resources">
{
    "op": [ "observeproperty" ],
    "href": "coap://[2001:DB8::1]/.../...",
    "coap:method": "GET",
    "subprotocol": "coap:observe"
}
</pre>
        </section>
        <section>
            <h3>Block-Wise Transfers</h3>
            <p>
                Parameters for blockwise transfer (as defined in [[RFC7959]]) can be set in a
                <code>coap:blockwise</code> member.
            </p>
            <p>
                ... <code>coap:blockwise</code> and <code>coap:quickblockwise</code>.
            </p>
            <pre id="example-feature-blockwise" class="example" title="Block-Wise Transfer">
{
    "op": [ "readproperty" ],
    "href": "coap://[2001:DB8::1]/.../...",
    "coap:method": "GET",
    "coap:blockwise": { }
}
</pre>
            <pre id="example-feature-blockwise-parameters" class="example" title="Block Size">
{
    "op": [ "readproperty" ],
    "href": "coap://[2001:DB8::1]/.../...",
    "coap:method": "GET",
    "coap:blockwise": {
        "coap:block2SZX": 64
    }
}
</pre>
        </section>
        <section>
            <h3>Conditional Requests</h3>
            <p>
                ...
            </p>
        </section>
        <section>
            <h3>Hop Limit</h3>
            <p>
                ... <code>coap:hopLimit</code>.
            </p>
            <pre id="example-feature-hoplimit" class="example" title="Hop Limit">
{
    "op": [ "invokeaction" ],
    "href": "coap://[2001:DB8::1]/.../...",
    "coap:method": "POST",
    "coap:hopLimit": 5
}
</pre>
        </section>
        <!--
        <section>
            <h3>OSCORE</h3>
        </section>
        <section>
            <h3>EDHOC</h3>
        </section>
        -->
    </section>
    <section id="url">
        <h2>URI Schemes</h2>
        <p>
            CoAP uses the following Uniform Resource Identifier (URI) schemes for identifying CoAP resources
            and providing a means of locating the resource:
        </p>
        <table class="data">
            <thead>
                <tr>
                    <th>URI Scheme</th>
                    <th>Reference</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>coap</td>
                    <td>[[RFC7252]]</td>
                </tr>
                <tr>
                    <td>coap+tcp</td>
                    <td>[[RFC8323]]</td>
                </tr>
                <tr>
                    <td>coap+ws</td>
                    <td>[[RFC8323]]</td>
                </tr>
                <tr>
                    <td>coaps</td>
                    <td>[[RFC7252]]</td>
                </tr>
                <tr>
                    <td>coaps+tcp</td>
                    <td>[[RFC8323]]</td>
                </tr>
                <tr>
                    <td>coaps+ws</td>
                    <td>[[RFC8323]]</td>
                </tr>
            </tbody>
        </table>
        <p>
            See the <a href="https://www.iana.org/assignments/uri-schemes/">Uniform Resource Identifier (URI) Schemes</a>
            registry for the complete list of CoAP URI schemes.
        </p>
    </section>
    <section id="vocabulary">
        <h2>CoAP Vocabulary</h2>
        <p>
            This section describes the vocabulary used in CoAP. A protocol
            binding implementation should use the vocabulary defined in this
            section to describe the different configuration that can be used to
            exchanged data between Web of Things.
        </p>
        <section>
            <h3>Form terms</h3>
            <table class="def">
                <thead>
                    <tr>
                        <th>Vocabulary term</th>
                        <th>Description</th>
                        <th>Assignment</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>coap:method</code></td>
                        <td>Indicates the CoAP method to be used in the request</td>
                        <td>optional</td>
                        <td>
                            <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#string"><code>string</code></a>
                            <p>
                                (see the
                                <a href="https://www.iana.org/assignments/core-parameters/#method-codes">CoAP Method Codes</a>
                                registry for the set of possible values)
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td><code>coap:format</code></td>
                        <td>Indicates that a payload in one of the specified formats with a matching CoAP Content-Format option [[RFC7252]] be included in the request</td>
                        <td>optional</td>
                        <td>
                            <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#unsignedShort"><code>unsignedShort</code></a>
                            or array of
                            <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#unsignedShort"><code>unsignedShort</code></a>
                            <p>
                                (see the
                                <a href="https://www.iana.org/assignments/core-parameters/#content-formats">CoAP Content-Formats</a>
                                registry for the set of possible values)
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td><code>coap:accept</code></td>
                        <td>Indicates that a CoAP Accept option [[RFC7252]] with one of the specified formats be included in the request</td>
                        <td>optional</td>
                        <td>
                            <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#unsignedShort"><code>unsignedShort</code></a>
                            or array of
                            <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#unsignedShort"><code>unsignedShort</code></a>
                            <p>
                                (see the
                                <a href="https://www.iana.org/assignments/core-parameters/#content-formats">CoAP Content-Formats</a>
                                registry for the set of possible values)
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td><code>coap:blockwise</code></td>
                        <td>Indicates that a block-wise transfer [[RFC7959]] is supported</td>
                        <td>optional</td>
                        <td><a href="#BlockWiseTransferParameters">BlockWiseTransferParameters</a></td>
                    </tr>
                    <tr>
                        <td><code>coap:qblockwise</code></td>
                        <td>Indicates that a quick block-wise transfer [[RFC9177]] is supported</td>
                        <td>optional</td>
                        <td><a href="#BlockWiseTransferParameters">BlockWiseTransferParameters</a></td>
                    </tr>
                    <tr>
                        <td><code>coap:hopLimit</code></td>
                        <td>Indicates that a CoAP Hop-Limit option [[RFC8768]] be included in the request</td>
                        <td>optional</td>
                        <td>
                            <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#unsignedByte"><code>unsignedByte</code></a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
        <section id="BlockWiseTransferParameters">
            <h3>BlockWiseTransferParameters</h3>
            <table class="def">
                <thead>
                    <tr>
                        <th>Vocabulary term</th>
                        <th>Description</th>
                        <th>Assignment</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>coap:block2SZX</code></td>
                        <td>Indicates the largest block size that may be used in a Block2 or Q-Block2 Option</td>
                        <td>optional</td>
                        <td>
                            <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#unsignedShort"><code>unsignedShort</code></a>
                            <p>(one of <code>16</code>, <code>32</code>, <code>64</code>, <code>128</code>, <code>256</code>, <code>512</code>, <code>1024</code>)</p>
                        </td>
                    </tr>
                    <tr>
                        <td><code>coap:block1SZX</code></td>
                        <td>Indicates the largest block size that may be used in a Block1 or Q-Block1 Option</td>
                        <td>optional</td>
                        <td>
                            <a href="https://www.w3.org/TR/2012/REC-xmlschema11-2-20120405/#unsignedShort"><code>unsignedShort</code></a>
                            <p>(one of <code>16</code>, <code>32</code>, <code>64</code>, <code>128</code>, <code>256</code>, <code>512</code>, <code>1024</code>)</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
    </section>
    <section id="mappings">
        <h2>Mappings</h2>
        <p>
            This section describes the strategies and default values to use
            protocol specific concepts within the
            <a href="https://w3c.github.io/wot-architecture/#dfn-interaction-model">WoT Interaction model</a>.
        </p>
        <section id="default-mappings">
            <h3>Default mappings</h3>
            <table class="def">
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th>Default Binding</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>readproperty</code></td>
                        <td><code>"coap:method": "GET"</code></td>
                    </tr>
                    <tr>
                        <td><code>writeproperty</code></td>
                        <td><code>"coap:method": "PUT"</code></td>
                    </tr>
                    <tr>
                        <td><code>observeproperty</code></td>
                        <td><code>"coap:method": "GET"</code>, <code>"subprotocol": "coap:observe"</code></td>
                    </tr>
                    <tr>
                        <td><code>unobserveproperty</code></td>
                        <td><code>"coap:method": "GET"</code>, <code>"subprotocol": "coap:observe"</code></td>
                    </tr>
                    <tr>
                        <td><code>readmultipleproperties</code></td>
                        <td><code>"coap:method": "GET"</code></td>
                    </tr>
                    <tr>
                        <td><code>writemultipleproperties</code></td>
                        <td><code>"coap:method": "PUT"</code></td>
                    </tr>
                    <tr>
                        <td><code>readallproperties</code></td>
                        <td><code>"coap:method": "GET"</code></td>
                    </tr>
                    <tr>
                        <td><code>writeallproperties</code></td>
                        <td><code>"coap:method": "PUT"</code></td>
                    </tr>
                    <tr>
                        <td><code>observeallproperties</code></td>
                        <td><code>"coap:method": "GET"</code>, <code>"subprotocol": "coap:observe"</code></td>
                    </tr>
                    <tr>
                        <td><code>unobserveallproperties</code></td>
                        <td><code>"coap:method": "GET"</code>, <code>"subprotocol": "coap:observe"</code></td>
                    </tr>
                    <tr>
                        <td><code>invokeaction</code></td>
                        <td><code>"coap:method": "POST"</code></td>
                    </tr>
                    <tr>
                        <td><code>queryaction</code></td>
                        <td><code>"coap:method": "GET"</code></td>
                    </tr>
                    <tr>
                        <td><code>cancelaction</code></td>
                        <td><code>"coap:method": "POST"</code></td>
                    </tr>
                    <tr>
                        <td><code>queryallactions</code></td>
                        <td><code>"coap:method": "GET"</code></td>
                    </tr>
                    <tr>
                        <td><code>subscribeevent</code></td>
                        <td><code>"coap:method": "GET"</code>, <code>"subprotocol": "coap:observe"</code></td>
                    </tr>
                    <tr>
                        <td><code>unsubscribeevent</code></td>
                        <td><code>"coap:method": "GET"</code>, <code>"subprotocol": "coap:observe"</code></td>
                    </tr>
                    <tr>
                        <td><code>subscribeallevents</code></td>
                        <td><code>"coap:method": "GET"</code>, <code>"subprotocol": "coap:observe"</code></td>
                    </tr>
                    <tr>
                        <td><code>unsubscribeallevents</code></td>
                        <td><code>"coap:method": "GET"</code>, <code>"subprotocol": "coap:observe"</code></td>
                    </tr>
                </tbody>
            </table>
        </section>
        <section id="possible-mappings">
            <h3>Possible mappings</h3>
            <p class="ednote">TODO: This section should describe other mappings that can be used by TD designers. It is meant to be informative but it provides guidelines for implementers.</p>
        </section>
    </section>
</body>

</html>
