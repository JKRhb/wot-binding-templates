<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class='remove'></script>
    <script class='remove'>
        var respecConfig = {
            specStatus: "ED",
            group: "wg/wot",
            editors: [{
                name: "Michael Koster",
                w3cid: "110658",
                company: "SmartThings",
                companyURL: "https://www.smartthings.com/"
                },
                {
                name: "Ege Korkan",
                w3cid: "110131",
                company: "Siemens AG",
                companyURL: "https://www.siemens.com/"
                }
            ],
            edDraftURI: "https://w3c.github.io/wot-binding-templates/bindings/protocols/mqtt/",
            shortName: "wot-mqtt-binding",
            github: "https://github.com/w3c/wot-binding-templates/tree/main/bindings/protocols/mqtt",
        };
    </script>
    <title>MQTT Binding Template</title>
</head>

<body>
    <section id="abstract">
      In the context of the <a href="https://www.w3.org/TR/wot-architecture/">Web of Things (WoT)</a>, a Binding Template is 
      a blueprint that gives guidance on how to implement a specific IoT protocol, data format or IoT platform. This document 
      gives implementation guidelines regarding the <a href='https://mqtt.org/mqtt-specification/'>MQTT protocol</a>. The MQTT protocol is
      a lightweight, asynchronous, transport-independent, open protocol for publishing and subscribing to messages. It has 
      been employed in many IoT platforms and IoT applications for its simplicity and scalability.
    </section>
    <section id='introduction'>
        <h2>Introduction</h2>
        <p class="ednote">the following is a draft introduction</p>
        <p>
            This document describes how to map the MQTT protocol to the W3C Web of Things.
        </p>
    </section>
    <section id='sotd'>
        <p>
            <em>This document is a work in progress</em>
        </p>
    </section>
    <section id="url">
      <h2>URL format</h2>
      <p class="ednote">There is no clear consensus on the correct URL format for MQTT protocol binding</p>
       <pre>
            {scheme}://{address}:{port}
        </pre>

        <p>
            Where:
            <ul>
                <li><code>{scheme}</code> is the protocol scheme, either <code>mqtt</code> or <code>mqtts</code></li>
                <li><code>{address}</code> is the IP address of the MQTT broker</li>
                <li><code>{port}</code> is the port of the MQTT broker</li>
            </ul>
        </p>
    </section>
    <section>
      <h3>MQTT Vocabulary</h3>
    <section>
      <h4>Form terms</h4>
      <table class="def">
        <thead>
          <tr>
            <th>Vocabulary term</th>
            <th>Description</th>
            <th>Assignment</th>
            <th>Type</th>
          </tr>
        </thead>
        <tbody>
          <!-- Generate forms terms from the ontology-->
          
        <tr>
            <td><code>mqv:retain</code></td>
            <td>If the RETAIN flag is set to 1 in a PUBLISH packet sent by a Client to a Server, the Server must replace any existing retained message for this topic and store the Application Message, so that it can be delivered to future subscribers whose subscriptions match its Topic Name.</td>
            <td>optional</td>
            <td><a href="http://www.w3.org/2001/XMLSchema#boolean">boolean</a></td>

        <tr>
        

        <tr>
            <td><code>mqv:controlPacket</code></td>
            <td>Describes the action of sending a <a href='#controlpacket'>ControlPacket</a> in a NetworkConnection</td>
            <td>optional</td>
            <td><a href="#controlpacket">ControlPacket</a></td>

        <tr>
        

        <tr>
            <td><code>mqv:qos</code></td>
            <td>This field indicates the level of assurance for delivery of an Application Message.</td>
            <td>optional</td>
            <td><a href="#qualityofservice">QualityOfService</a></td>

        <tr>
        

        <tr>
            <td><code>mqv:topic</code></td>
            <td>This field reports the <a href='#topicname'>TopicName</a> of a packet</td>
            <td>optional</td>
            <td><a href="#topicname">TopicName</a></td>

        <tr>
        

        <tr>
            <td><code>mqv:filter</code></td>
            <td>This field reports the list of <a href='#topicfilter'>TopicFilter</a>s of a packet</td>
            <td>optional</td>
            <td><a href="#topicfilter">TopicFilter</a> Array of <a href="#topicfilter">TopicFilter</a></td>

        <tr>
        
        </tbody>
      </table>
    </section>
    <section id="controlpacket">
      <h4>Control Packet</h4>
      <p>
        In MQTT protocol messages are called Control Packets. An MQTT Control Packet consists of up to three parts: fixed header (prsesent in all Control Packets), variable header,
        payload. The fixed header consists of a packet type and flags. The main packet types that can be uses in a Form are listed below. 
      </p>
      <table class="def">
        <thead>
          <tr>
            <th>Value</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <!-- Generate packet values from the ontology-->
          
        <tr>
            <td><code>mqv:publish</code></td>
            <td>A PUBLISH packet is sent from a Client to a Server or from a Server to a Client to transport an Application Message.</td>
        <tr>
        

        <tr>
            <td><code>mqv:subscribe</code></td>
            <td>The SUBSCRIBE packet is sent from the Client to the Server to create one or more Subscriptions. Each Subscription registers a Clientâ€™s interest in one or more Topics.</td>
        <tr>
        

        <tr>
            <td><code>mqv:unsubscribe</code></td>
            <td>An UNSUBSCRIBE packet is sent by the Client to the Server, to unsubscribe from topics.</td>
        <tr>
        
        </tbody>
      </table>
    </section>
    <section id="qualityofservice">
      <h4>QualityOfService</h4>
      <p>
        <!-- Generate qos description from the ontology-->
        
        QualityOfService level paired to a specific Topic Filter used in a SUBSCRIBE or SUBACK packet payload.
        
      </p>
      <table class="def">
        <thead>
          <tr>
            <th>Value</th>
            <th>Name</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <!-- Generate qos values from the ontology-->
          
        <tr>
            <td><code>mqv:0</code></td>
            <td>atMostOnce</td>
            <td>The Server delivers the Application Message to the Client once and only once.</td>
        <tr>
        

        <tr>
            <td><code>mqv:1</code></td>
            <td>atLeastOnce</td>
            <td>The message is delivered at least once.</td>
        <tr>
        

        <tr>
            <td><code>mqv:2</code></td>
            <td>exactlyOnce</td>
            <td>The message is delivered exactly once.</td>
        <tr>
        
        </tbody>
      </table>
    </section>
    <section id="topicname">
      <h4>TopicName</h4>
      <p>
        <!-- Generate description form the ontology-->
        
        The label attached to an Application Message which is matched against the Subscriptions known to the Server. The Server sends a copy of the Application Message to each Client that has a matching Subscription.
        
      </p>
    
    </section>
    <section id="topicfilter">
      <h4>TopicFilter</h4>
      <p>
        <!-- Generate description form the ontology-->
        
        An expression contained in a Subscription, to indicate an interest in one or more topics. A Topic Filter can include wildcard characters.
        
      </p>
    
    </section>
    </section>
    <section>
      <h3>Mappings</h3>
      <p>This section describes strategies and default values to employ protocol specific concepts within the <a
          href="https://w3c.github.io/wot-architecture/#dfn-interaction-model">WoT Interaction
          model</a>. </p>
      <section id="default-mappings">
        <h3>Default mappings</h3>
      <table class="def">
        <thead>
          <tr>
            <th><code>op</code> value</th>
            <th>Default Binding</th>
          </tr>
        </thead>
        <tbody>
          <!-- Generate forms terms from the ontology-->
          
        <tr>
            <td><code>readproperty</code></td>
            <td><code>"mqv:controlPacket": "mqv:subscribe"</code></td>
        <tr>
        

        <tr>
            <td><code>writeproperty</code></td>
            <td><code>"mqv:controlPacket": "mqv:publish"</code></td>
        <tr>
        

        <tr>
            <td><code>observeproperty</code></td>
            <td><code>"mqv:controlPacket": "mqv:subscribe"</code></td>
        <tr>
        

        <tr>
            <td><code>unobserveproperty</code></td>
            <td><code>"mqv:controlPacket": "mqv:unsubscribe"</code></td>
        <tr>
        

        <tr>
            <td><code>readallproperties</code></td>
            <td><code>"mqv:controlPacket": "mqv:subscribe"</code></td>
        <tr>
        

        <tr>
            <td><code>readmultipleproperties</code></td>
            <td><code>"mqv:controlPacket": "mqv:subscribe"</code></td>
        <tr>
        

        <tr>
            <td><code>writeallproperties</code></td>
            <td><code>"mqv:controlPacket": "mqv:publish"</code></td>
        <tr>
        

        <tr>
            <td><code>writemultipleproperties</code></td>
            <td><code>"mqv:controlPacket": "mqv:publish"</code></td>
        <tr>
        

        <tr>
            <td><code>invokeaction</code></td>
            <td><code>"mqv:controlPacket": "mqv:publish"</code></td>
        <tr>
        

        <tr>
            <td><code>subscribeevent</code></td>
            <td><code>"mqv:controlPacket": "mqv:subscribe"</code></td>
        <tr>
        

        <tr>
            <td><code>unsubscribeevent</code></td>
            <td><code>"mqv:controlPacket": "mqv:unsubscribe"</code></td>
        <tr>
        
        </tbody>
      </table>
      </section>
      <section id="possible-mappings">
        <h3>Possible mappings</h3>
      For the MQTT protocol, if an MQTT client publishes a message to a topic with the retain flag set to true, the future subscribers of the topic will also get this message.
      Outside of this case, it is not possible to read a property but only possible to observe it. 
      <span class="rfc2119-assertion" id="iana-security-alter">Additionally, in a Form element with MQTT protocol, if the <code>op</code> contains <code>readproperty</code> (meaning that retain flag is set to true), it <em class="rfc2119" title="SHOULD">SHOULD</em> also contain <code>observeproperty</code>.</span>
      <span class="rfc2119-assertion" id="iana-security-alter">On the other hand, if the MQTT publisher does not set
        the retain flag to true, the property will be only observable. In this case, the property in the exposed Thing
        Description <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> have Form elements with MQTT protocol containing <code>readproperty</code> operation.</span>
      </section>
  </section>
    <section>
      <h2>Examples</h2>
      <p>The following examples show how to use the MQTT protocol in a Thing Description.</p>
      <p class="ednote">TODO:</p>
    </section>
</body>

</html>